apply plugin: 'maven-publish'

allprojects {
    group = GROUP
    version = VERSION
}

subprojects {
    buildDir = rootProject.file("build/${project.name}")

    repositories {
        mavenCentral()

        flatDir {
            dirs rootProject.file('libs')
        }
    }

    publishing {
        repositories {
            mavenLocal()
        }
    }
}

subprojects.each { subproject -> evaluationDependsOn(subproject.path) }


task flashlibSources(type: Jar, dependsOn: subprojects.classes) {
    baseName = 'flashlib'
    destinationDir = rootProject.buildDir
    classifier = 'sources'

    from files(subprojects.collect {
        it.sourceSets.main.allSource
    })
}

task flashlibJavadoc(type: Jar, dependsOn: subprojects.javadoc) {
    baseName = 'flashlib'
    destinationDir = rootProject.buildDir
    classifier = 'javadoc'

    from files(subprojects.collect {
        it.javadoc.destinationDir
    })
}

task flashlib(type: Jar, dependsOn: subprojects.build) {
    dependsOn flashlibSources
    dependsOn flashlibJavadoc

    baseName = 'flashlib'
    destinationDir = rootProject.buildDir

    from files(subprojects.collect {
        it.sourceSets.main.output
    })
}

task flashlibAll(type: Jar, dependsOn: flashlib) {
    dependsOn flashlibSources
    dependsOn flashlibJavadoc

    baseName = 'flashlib-all'
    destinationDir = rootProject.buildDir

    from files(subprojects.collect {
        it.sourceSets.main.output
    })
    from files(subprojects.collect {
        it.sourceSets.main.allSource
    })
    from files(subprojects.collect {
        it.javadoc.destinationDir
    })
}

publishing {
    publications {
        mavenFlashlib(MavenPublication) {
            artifactId = 'flashlib'

            artifact flashlib
            artifact flashlibJavadoc
            artifact flashlibSources
        }
    }
}